os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
  - brew update
  - brew install dpkg ldid
  - git clone --recursive git://github.com/theos/theos.git ~/theos
script:
  - "export VERSION=$(grep 'Version: ' control | sed 's/^.*: //')"
  - "export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)"
  - "export FILENAME='packages/'\"$(grep 'Package: ' control | sed 's/^.*: //')\"'_'\"$VERSION\"'_iphoneos-arm.deb'"
  - make package
before_deploy:
  - git config --local user.name "Jeff Rescignano"
  - git config --local user.email "jeff@jeffresc.com"
  - if [ "$TRAVIS_BRANCH" == "release" ]; then git tag -a v$VERSION -m "$DESCRIPTION"; fi
deploy:
  provider: releases
  api_key:
    secure: rSRUCp+imhukl1E3NgJHwvNJgEVVQXMsLNlHXkpsjGvy+d8IBeCaoxUqHxmbmIiXfiicPJdhgidTfNV3rw0a+JoWRfliw8tsSx3HJgCGAFVPORoVokQFKA117fJNrEx0SWfPhcBKF+UX9RuOs3iiQfAmKpSszBhZt69Au4bqgvEGu0vz3EvqflnDmsDcbOysOtuM0tB6kyEUpJ16Ay9Mjsi3Mq1rj8xXvapm3DPSUl687wfuKCY6d/jv7Wg30t5xUwU1/RSVfKvwEt8MILnW3v6lTKxLuE6Mrfwub8R6Uzwn5c9nl7UCCot7GQYTj35HDpKvfOyVLuojt86hrC3Mp1QRI1jKD8UZxK3jnmq6e8OkNji6SI77nMcFtmyM81jRRFalIKWuK2CCBoUAbJrpVSlxKpOZvxcAwnI99LEfvNu7XWm20305AlKJysqBGRRNrJQLwWx0z9z3yU/P5v3KQO37WpdlW5q4R6m+UU+aLSbXazbalX0/UTKl0kQPRcawvCdp1NxeXLrLXRv7i80gFlm1r7KEa2dYiuaNOtWh2noyp1oAp6L9tTI4JEXikdLHImZlnrkpvLZXQ40OcQjynyrsLWVcOBUYRVkYPBhPl+npiM/GGPcsyICiUdY7KUtA/X4vmKunIgNr4yRGdjK2MeFl812qHmZ0tdN7Lv8Trhw=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - release
branches:
  except:
  - /^untagged/
